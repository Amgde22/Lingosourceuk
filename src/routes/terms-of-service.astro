---
import BaseLayout from "@layouts/BaseLayout.astro";
// The 't' function is assumed to be correctly configured to fetch the provided JSON data
// from a path like 'legal.termsOfService'.
import { t } from "i18n:astro";
import { getOptimizedImage } from "@utils/utils";

import mobileLandingImage from "@assets/images/hero.png";

const optimizedMobileLandingImage = await getOptimizedImage(mobileLandingImage);

// Fetch the entire termsOfService object from your i18n JSON file.
// We specifically target the 'tos' object within the fetched data.
const tosData = t("legal:termsOfService", { returnObjects: true });
---

<BaseLayout
  title={tosData.title}
  description={tosData.introduction.main}
  preloadedImage={optimizedMobileLandingImage}
>
  <!-- This div is a placeholder for a fixed header -->
  <div class="place-taker"></div>

  <style lang="less">
    .terms-container {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem 2rem;
      background-color: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
    }

    h1, h2, h3, h4 {
      color: #1a202c;
      line-height: 1.3;
      font-weight: 600;
    }

    h1 {
      font-size: 2.25rem;
      text-align: center;
      margin-bottom: 0.5rem;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 1rem;
    }

    .meta-info {
      text-align: center;
      color: #718096;
      font-size: 0.9rem;
      margin-bottom: 2.5rem;
    }

    h2 {
      font-size: 1.75rem;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e2e8f0;
    }

    h3 {
      font-size: 1.25rem;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      color: #2d3748;
    }
    
    h4 {
      font-size: 1.1rem;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      color: #4a5568;
    }

    p {
      margin-bottom: 1rem;
    }

    ul {
      list-style-type: disc;
      padding-left: 20px;
      margin-bottom: 1rem;

      li {
        margin-bottom: 0.5rem;
      }
    }

    strong {
      font-weight: 600;
      color: #2d3748;
    }
    
    .contact-info {
        background-color: #f7fafc;
        border: 1px solid #e2e8f0;
        padding: 1.5rem;
        border-radius: 6px;
        margin-top: 2rem;

        p {
            margin-bottom: 0.5rem;
        }
    }

  </style>

  <div class="terms-container">
    <!-- Main Title and Meta Info -->
    <h1>{tosData.brandName} {tosData.title}</h1>
    <div class="meta-info">
      <p><strong>{tosData.effectiveDateLabel}:</strong> {tosData.effectiveDate}</p>
      <p><strong>{tosData.lastUpdatedLabel}:</strong> {tosData.lastUpdated}</p>
    </div>

    <!-- Introduction Section -->
    <section class="introduction">
      <p>{tosData.introduction.main}</p>
      <p>{tosData.introduction.acceptance}</p>
      <p>{tosData.introduction.privacyPolicy}</p>
    </section>

    <!-- Main Content Sections -->
    {tosData.sections.map((section) => (
      <section id={`section-${section.id}`}>
        <h2>{section.id}. {section.title}</h2>
        
        {/* Render Subsections if they exist */}
        {section.subsections && section.subsections.map((subsection) => (
          <div class="subsection" id={`subsection-${subsection.id}`}>
            <h3>{subsection.id} {subsection.title}</h3>
            
            {/* Render simple content paragraph if it exists */}
            {subsection.content && <p>{subsection.content}</p>}
            
            {/* Render list if it exists */}
            {subsection.list && (
              <ul>
                {subsection.list.map((item) => (
                  <li>{item}</li>
                ))}
              </ul>
            )}
          </div>
        ))}
        
        {/* Render the special Contact Information details if they exist */}
        {section.details && (
            <div class="contact-info">
                <p><strong>{section.details.companyLabel}:</strong> {section.details.companyName}</p>
                <p><strong>{section.details.tradingNameLabel}:</strong> {section.details.tradingName}</p>
                <p><strong>{section.details.companyNumberLabel}:</strong> {section.details.companyNumber}</p>
                <p><strong>{section.details.registeredAddressLabel}:</strong> {section.details.registeredAddress}</p>
                <p><strong>{section.details.emailLabel}:</strong> <a href={`mailto:${section.details.email}`}>{section.details.email}</a></p>
                <p><strong>{section.details.businessHoursLabel}:</strong> {section.details.businessHours}</p>
            </div>
        )}

        {/* Render the closing statement for the contact section */}
        {section.closingStatement && <p>{section.closingStatement}</p>}
      </section>
    ))}
  </div>
</BaseLayout>